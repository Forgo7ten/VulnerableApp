# Content Provider文件目录遍历漏洞

## 漏洞简介

对外暴露的Content Provider实现了openFile()接口，因此其他有相应调用该ContentProvider权限的应用即可调用ContentProvider的openFile接口进行文件数据访问。

但是如果没有进行ContentProvider访问权限控制和对访问的目标文件Uri进行有效判断，攻击者利用文件目录遍历访问任意可读文件。

### 漏洞详情

Android ContentProvider存在文件目录遍历安全漏洞，该漏洞源于对外暴露ContentProvider组件的应用，没有对ContentProvider组件的访问进行权限控制和对访问的目标文件的ContentQueryUri进行有效判断。

攻击者利用该应用暴露的ContentProvider的openFile()接口进行文件目录遍历以达到访问任意可读文件的目的。

```markdown
public ParcelFileDescriptor openFile(@NonNull Uri uri, @NonNull String mode)
```

对外暴露的ContentProvider组件**实现了openFile()接口**，**没有对所访问的目标文件Uri进行有效判断**，如**没有过滤**限制如`../`可实现任意刻度文件的访问的ContentQueryUri

### 漏洞危害

### 修复建议

-   非必要导出设置为不导出
-   如果没有读写文件的必要，去除`openFile()`方法接口
-   过滤限制跨域访问，对访问的目标文件路径进行有效判断
    -   使用Uri.decode()先对ContentQueryUri进行解码后，再对`uri`进行校验，过滤其中类似于`../`的字符串
-   设置权限来进行内部应用通过Content Provider的数据共享

## 漏洞复现

>   复现环境：Pixel; AOSP_Android10.0.0_r2

参考AttackApp应用
